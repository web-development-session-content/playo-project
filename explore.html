<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link rel="stylesheet" href="./styles/navbar.css">
  <link rel="stylesheet" href="./styles/explore.css">
  <!-- <link rel="stylesheet" href="./styles/popup.css"> -->
  <link rel="stylesheet" href="./styles/activity.css">
  <link rel="stylesheet" href="./styles/footer.css">
</head>

<body>
  <div id="main">

    <!-- Navbar start -->
    <div id="explorenavbar" style="height: 50px; margin-bottom: 35px;">


    </div>
    <!-- Navbar End -->


    <div id="filter">
      <div id="locationfilter">
        <img src="./images/crosshair.png" alt="" class="icon" />
        <div class="align">
          <P class="filtertext">Location</P>

          <span id="place"></span>
        </div>
        <div id="searchicon">
          <img src="./images/location.png" alt="" class="icon2" />
          <P style="transform: translateY(15px);" id="detect">Detect</P>
        </div>
      </div>
      <div id="searchfilter">
        <img src="./images/search.png" alt="" class="icon">
        <div class="align">
          <p class="filtertext">Search</p>
          <input type="text" class="shade filtertext" placeholder='For example,"Football"'>

        </div>
      </div>
      <div id="sportsfilter">
        <img src="./images/soccer.png" alt="" class="icon">
        <div class="align">
          <p class="filtertext">Sport</p>
          <select class="bold space">
            <option value="Select Sports">Select Sports</option>
            <option value="Cricket">Cricket</option>
            <option value="Football">Football</option>
            <option value="Tennis">Tennis</option>
            <option value="Bowling">Bowling</option>
          </select>
        </div>

      </div>
      <div id="catfilter">
        <img src="./images/category.png" alt="" class="icon">
        <div class="align">
          <p class="filtertext">Sort</p>
          <select class="bold space1">
            <option value="Select">- - - Select - - -</option>
            <option value="lth">By Name : a-z</option>
            <option value="htl">By Name : z-a</option>
            <option value="time">By Timings</option>
          </select>
        </div>
      </div>
    </div>
    <div id="con"></div>
    <!-- <div id= "places">
        <div>
          <img src="https://playo-activities.gumlet.io/SVMBOWLINGALLEY/SVMBowlingAlleycover.jpg?q=40" alt="" class="conimage">
          <p class="imgtext">Book</p>
        </div>
        <p class="highlighttext">shiva</p>
        <p class="location">hyd</p>
        <p class="timing"><img src="./images/clock.png" alt="" class="clockicon">ljljl</p>
        <p class="coaching">lsjdfljsd</p>
      </div> -->
    <div id="infooter">

    </div>
</body>

</html>



<script type="module">
  import navbar from "./components/navbar.js"
  document.querySelector("#explorenavbar").innerHTML = navbar()
  import footer from "./components/footer.js"
  document.querySelector("#infooter").innerHTML = footer()
  // for (let x in data) {
  //   var cityx = data[x];
  // }
  // console.log(cityx);

  // let con = document.getElementById("con");

  // async function add(url) {
  //   try {
  //     var url = `http://127.0.0.1:5000/playo/cities`;
  //     let response = await fetch(url, {
  //       method: "GET",
  //       headers: {
  //         "Content-Type": "application/json",
  //       },
  //     });
  //     let d = await response.json();
  //     console.log("d:", d);
  //     display(d);
  //   } catch (err) {
  //     console.log("err:", err);
  //   }
  // }


  // display = (e) => {
  //   //  console.log('e:', e)
  //   e.forEach((el) => {
  //     for (x in data) {
  //       var c = data[x];
  //     }

  //     //   var div = document.getElementById("places");
  //     //   // div.setAttribute("id","places")
  //     //   var location= document.createElement("p");
  //     //   location.innerText= el.location
  //     //   let img= document.createElement("img")
  //     //   img.src= el.image
  //     //   img.setAttribute("id","conimage")

  //     //   let timing= document.createElement("p")
  //     //   timing.innerText=el.timing

  //     // // console.log(el.timing)

  //     //   var name = document.createElement("p");
  //     //   name.innerText=el.name

  //     //   Book= "BOOKABLE",
  //     //   safe= "Safe & Hygiene"

  //     if (el.city === c) {
  //       let y = `  <div onclick="details(${el.id})" id= "places">
  //       <div>
  //         <img src="${el.image}" alt="" class="conimage">
  //         <p class="imgtext">Coaching</p>
  //       </div>
  //       <p class="highlighttext">${el.name}</p>
  //       <p class="location">${el.location}</p>
  //       <p class="timing"><img src="./images/clock.png" alt="" class="clockicon">${el.timing}</p>
  //       <p class="coaching">${el.name}  Coaching</p>
  //     </div>`;

  //       let place = document.getElementById("place");
  //       place.setAttribute("class", "bold");
  //       place.innerHTML = el.city;
  //       con.innerHTML += y;
  //     } else {
  //       console.log("err");
  //     }
  //   });
  // };


  // add();
 









//Filtering array of objects from the data base start (With Debouncing Feature)

//=======================================================================>

    //Selectiong Html Content

   


    let my_value = JSON.parse(localStorage.getItem("name"));
    // console.log(my_value.city)
    let search_value = my_value.city;
    //Search Function Code 
    let searchLocation = async(val="") =>{
        //Getting the value again
      try{
        let response = await fetch(`https://sleepy-teddy-newt.cyclic.app/activites?${val}`);
        let data = await response.json();
        //console.log(data);
      
        //Writing Function for filter data based on search results
        console.log(data)
        let filterDataArr = data.filter((el)=>{
            return search_value.toLowerCase().includes(el.city.toLowerCase())
        })
        if(filterDataArr.length==0) con.innerHTML = "<h1>No events in selected City</h1>"
        console.log(filterDataArr);
        apprndData(filterDataArr)
      }catch(e){
        console.log(e)
      }
    }
    searchLocation();

  //===========================================================================>




   //Append Data Function 
   let apprndData = (data) =>{
    console.log(data)
    let con = document.querySelector("#con")
    con.innerHTML = ""
    data.map((el)=>{
      let div = document.createElement("div")
      div.id = "places"
      div.classList = "classDiv"
      let y = `
        <div>
          <img src="${el.image}" alt="" class="conimage">
          <p class="imgtext">Coaching</p>
        </div>
        <p class="highlighttext">${el.name}</p>
        <p class="location">${el.location}</p>
        <p class="timing"><img src="./images/clock.png" alt="" class="clockicon">${el.timing}</p>
        <p class="coaching">${el.name}  Coaching</p>
      </div>`;
        div.innerHTML = y;
        div.addEventListener("click",()=>{
          details(el.id)
        })
        con.append(div)
    })

    let place = document.getElementById("place");
    place.setAttribute("class", "bold");
    place.innerHTML = search_value;

   }


   let details = (x) => {
    console.log("id:", x);
    let data = {
      id: x,
    };

    let location = localStorage.setItem("id", JSON.stringify(data));
    window.location.href = "detail.html";
  }


//Filtering array of objects from the data base End (With Debouncing Feature)

  document.querySelector("#locationfilter").addEventListener("click",()=>{
    location.href = "./activites.html"
  })

  document.querySelector("#sportsfilter select").addEventListener("change",()=>{
    let val = event.target.value
    if(val!=="Select Sports") searchLocation("q="+val)
    else searchLocation()
  })

  document.querySelector("#searchfilter input").addEventListener("keyup",()=>{
    let val = event.target.value
    searchLocation("q="+val)
  })

  document.querySelector("#catfilter select").addEventListener("change",()=>{
    let val = event.target.value
    console.log(val)
    if(val==="htl") searchLocation("_sort=name&_order=desc")
    else if(val==="lth") searchLocation("_sort=name&_order=asc")
    else if(val==="time") searchLocation("_sort=timings&_order=desc")
  })




</script>