<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<link rel="stylesheet" href="./styles/navbar.css">
	<link rel="stylesheet" href="./styles/activity.css">
	<!-- <link rel="stylesheet" href="./css/explore.css"> -->
	<link rel="stylesheet" href="./css/popup.css">
	<link rel="stylesheet" href="./styles/footer.css">
</head>

<body>
	<div id="explorenavbar" style="height: 50px; margin-bottom: 50px;">

	</div>



	<!--    popupwindow      ------------------------------------------------------ -->
	<div id="show">
		<!--popupwindow show here  -->
		
	</div>
	</div>

	<!--  -->
	<div id="searchbar" style="margin-bottom: 25px;">
		<input type="text" id="typesearch" placeholder="Type a city"
			style="border: 1px solid grey; border-top-left-radius: 2px; border-top-right-radius: 2px;">
		<button id="searchbtn">Detect</button>
	</div>
	<div id="citynames">
		<p>All citiies</p>
		<hr>

	</div>

	<div id="footer"></div>


</body>

</html>
<script type="module">
	import navbar from "./components/navbar.js"
	document.getElementById("explorenavbar").innerHTML=navbar();

	import getpopup from "./components/popup.js"
	document.getElementById("show").innerHTML=getpopup();

	import footer from "./components/footer.js"
	document.querySelector("#footer").innerHTML = footer()

	window.onload = () =>{
		document.querySelector("#typesearch").value = ""
	}
	document.querySelector("#typesearch").addEventListener("keyup",(event)=>{
		let inp = document.querySelector("#typesearch").value
		if(event.key=="Enter") redirect()
		fetchCities(inp)
	})
	let id;
	let fetchCities = (inp) =>{
		// console.log("here")
		if(id) clearTimeout(id)
		id = setTimeout(async()=>{
		// console.log("here2")
			try{
				let response = await fetch(`https://sleepy-teddy-newt.cyclic.app/city_names?q=${inp}&_limit=10&_sort=city`)
				let searchArr = await response.json()
				console.log(searchArr)
				setCities(searchArr)
			}catch(error){
				console.log(error)
			}
		},500)
	}
	fetchCities("")
	let setCities = (searchArr) =>{
		var showcities=document.querySelector("#citynames")
		if(searchArr.length==0) showcities.innerHTML = "<p>No such city</p><hr>"
		else if(searchArr.length == 500) showcities.innerHTML = "<p>All cities</p><hr>"
		else showcities.innerHTML = ""
		for(var i=0; i<searchArr.length; i++){
			let city = searchArr[i].city
			var p=document.createElement("p");
			var line=document.createElement("hr");
			p.innerHTML= city;
			p.addEventListener("click",()=>{
				document.querySelector("#typesearch").value = city
			})
			showcities.append(p,line);
		}
	}
	//  popupstartshere-----------------------
// var modal = document.getElementById("myModal");
// var modal1=document.getElementById("myModal1")

// // Get the button that opens the modal
// var btn = document.getElementById("myBtn");
// // btn.innerHTML= JSON.parse(localStorage.getItem("myLocal"))[0]|| "Login/Signup";
// var submit=document.getElementById("btn");
// var verify=document.getElementById("btn2")

// Get the <span> element that closes the modal
// var span = document.getElementsByClassName("close")[0];
// When the user clicks the button, open the modal 
// btn.onclick = function() {
// 	if (btn.innerHTML=="Login/Signup"){
// 		modal.style.display = "block";
// 	}
// 	else{
// 		document.getElementById("dropdowndiv").style.visibility="visible";
// 	}
  

// }



// submit.onclick=function(){
//     var mobnumber=document.querySelector("#mobnum").value;
//     //console.log(mobnumber)
//  if(mobnumber){
//     modal.style.display = "none";
//     modal1.style.display = "block";
//  }
//  else{
//      alert("pls fill no.");
//  }
// }
// verify.onclick = function(event) {
//     event.preventDefault()
//   var data=JSON.parse(localStorage.getItem("myLocal"))
//   console.log(data[0]);
//   btn.innerHTML=data[0]
//   modal.style.display = "none";
//   modal1.style.display = "none";

// }

// // When the user clicks on <span> (x), close the modal
// span.onclick = function() {
//     modal1.style.display = "none";
//   modal.style.display = "none";
 
// }

// // When the user clicks anywhere outside of the modal, close it
// window.onclick = function(event) {
//   if (event.target == modal) {
//     modal.style.display = "none";
    
//   }
// }

// document.getElementById("form").addEventListener("submit",myFn)
// //   var arr=JSON.parse(localStorage.getItem("myLocal"))||[]

// function myFn(event)
// {var arr=[];
// event.preventDefault()
// var myobj=document.querySelector("#mobnum").value;
// arr.push(myobj)
// localStorage.setItem("myLocal",JSON.stringify(arr))
// }

// function find() {
//     // let c= document.getElementById("cities").value
//     // console.log(c)
    
//     let data = {
//       city: document.getElementById("typesearch").value,
     
//     };

//     let location = localStorage.setItem("name", JSON.stringify(data));
//     window.location.href = "explore.html";
//   }


document.querySelector("#searchbtn").addEventListener("click",()=>{
    redirect()
})
let redirect = () =>{
	let data = {
      city: document.getElementById("typesearch").value,
    };

    let location = localStorage.setItem("name", JSON.stringify(data));
    window.location.href = "explore.html";
}






































    </script>